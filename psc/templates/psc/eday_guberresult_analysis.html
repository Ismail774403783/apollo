{% extends 'psc/layout.html' %}
{% block javascripts %}
{{ block.super }}
<script src="/assets/js/jquery-1.4.4.min.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" charset="utf-8">
    $(function() {
        $("#reset").click(function () {
            $("#id_date").val("");
            $("#id_sample").val("");
		});
    });
</script>
<style>
    .mid th, .mid td { vertical-align: middle; }
</style>
{% endblock %}
{% load calc %}
{% load dict-filters %}
{% block content %}
<div class="grid_16">
    <div class="box">
        <div class="block">
            <div id="filter">
                <form action="" method="get" id="filter_form" accept-charset="utf-8">
                    <table>
                        <thead>
                            <tr>
                                <th width="10%">{{ filter_form.state.label }}</th>
                                <th>&nbsp;</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>{{ filter_form.state }}</td>
                                <td><input type="button" value="reset" id="reset"> <input type="submit" value="filter &rarr;"></td>
                            </tr>
                        </tbody>
                    </table>
                </form>
            </div>
        </div>
    </div>
    <div class="box">
	<h2><strong>Turnout Analysis for State</strong></h2>
	<div class="block">
		<table width="100%" class="summary">
		    <thead>
			<tr>
			    <th>LGA</th>
			    <th>N</th>
			    <th>n</th>
			    <th>n%</th>
			    <th>RV</th>
			    <th>T</th>
			    <th>T%</th>
			</tr>
		    </thead>
			{% for state in turnout.states %}
			<tr {% cycle '' 'class="odd"' %}>
			    <td>{{ state.name }}</td>
			    <td>{{ state.N }}</td>
			    <td>{{ state.n }}</td>
			    <td>{{ state.n|percentage:state.N }}</td>
			    <td>{{ state.RV }}</td>
			    <td>{{ state.T }}</td>
			    <td>{{ state.T|percentage:state.RV }}</td>
			</tr>
			{% endfor %}
			<tr>
			    <th>Totals</th>
			    <th>{{ turnout.state.totals.N }}</th>
			    <th>{{ turnout.state.totals.n }}</th>
			    <th>{{ turnout.state.totals.n|percentage:turnout.state.totals.N }}</th>
			    <th>{{ turnout.state.totals.RV }}</th>
			    <th>{{ turnout.state.totals.T }}</th>
			    <th>{{ turnout.state.totals.T|percentage:turnout.state.totals.RV }}</th>
			</tr>
		</table>
	</div>
    </div>
	<div class="box">
	<h2><strong>Qualitative Analysis for States</strong></h2>
	<div class="block">
		<table width="100%" class="summary">
		    <thead>
			<tr>
			    <th>Party</th>
				{% for lga in results.lgas  %}
			    <th colspan="2">{{ lga }}</th>
				{% endfor %}
			</tr>
			<tr>
			    <th>&nbsp;</th>
				{% for lga in results.lgas  %}
			    <th>n</th>
			    <th>n%</th>
				{% endfor %}
			</tr>
		    </thead>
			{% for party in party_codes %}
			<tr {% cycle '' 'class="odd"' %}>
			    <td>{{ party_names|key_value:party }}</td>
			{% for lga in results.lgas %}
			{% with results.lga.parties|key_value:party|key_value:lga|key_value:'N' as en %}
			    <td>{{ results.lga.parties|key_value:party|key_value:lga|key_value:'n' }}</td>
				<td>{{ results.lga.parties|key_value:party|key_value:lga|key_value:'n'|percentage:en }}</td>
			{% endwith %}
			{% endfor %}
			</tr>
			{% endfor %}
			<tr>
			    <th>Totals</th>
			{% for lga in results.lgas %}
			    <th>{{ results.lga.party_totals|key_value:lga|key_value:'n'|default:"0" }}</th>
				<th>100%</th>
			{% endfor %}
			</tr>
		</table>
	</div>
    </div>
</div>
{% endblock %}

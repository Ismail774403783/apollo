{% extends "core/layout.html" %}
{% load apollo %}
{% block content %}
  {% with submission.siblings as siblings %}
  <form action="" method="post">
    {% csrf_token %}
  <div class="row">
    <div class="span12">
      <table class="table table-bordered">
        <thead>
          {% if submission.form.type == 'CHECKLIST' %}
          <tr>
            <th>&nbsp;</th>
            <th>1</th>
            {% for sibling in siblings %}
            <th>{{ forloop.counter|add:"1" }}</th>
            {% endfor %}
          </tr>
          {% endif %}
          <tr>
            <th>Observer</th>
            <td><strong>{{ submission.observer.name }}</strong>{% if submission.observer.phone %} ({{ submission.observer.phone }}){% endif %} &mdash; <strong>{{ submission.observer.observer_id }}</strong></td>
            {% for sibling in siblings %}
            <td><strong>{{ sibling.observer.name }}</strong>{% if sibling.observer.phone %} ({{ sibling.observer.phone }}){% endif %} &mdash; <strong>{{ sibling.observer.observer_id }}</strong></td>
            {% endfor %}
          </tr>
          <tr>
            <th>Location</th>
            <td><strong>{{ submission.location }}</strong></td>
            {% for sibling in siblings %}
            <td><strong>{{ sibling.location }}</strong></td>
            {% endfor %}
          </tr>
          {% if location_types %}
          <tr>
            <th>&nbsp;</th>
            <td>{% for location_type in location_types %}{% get_location_for_type submission location_type %}{% if not forloop.last %} / {% endif %}{% endfor %}</td>
            {% for sibling in siblings %}
            <td>{% for location_type in location_types %}{% get_location_for_type sibling location_type %}{% if not forloop.last %} / {% endif %}{% endfor %}</td>
            {% endfor %}
          </tr>
          {% endif %}
          <tr>
            <th>Supervisor</th>
            <td>{{ submission.observer.supervisor|default_if_none:"" }}</td>
            {% for sibling in siblings %}
            <td>{{ sibling.observer.supervisor|default_if_none:"" }}</td>
            {% endfor %}
          </tr>
        </thead>
      </table>
      {% if submission.form.type == 'CHECKLIST' %}
      <table class="table table-striped table-bordered table-hover submission-table">
        <tbody>
          <tr>
            <td colspan="2">&nbsp;</td>
            <td style="text-align:center"><strong>1</strong></td>
            {% for sibling in siblings %}
            <td style="text-align:center"><strong>{{ forloop.counter|add:"1" }}</strong></td>
            {% endfor %}
            <td>&nbsp;</td>
          </tr>
          {% for fieldset in form.fieldsets %}
          {% if fieldset.legend %}
          <tr>
            <td colspan="{{ siblings.count|add:"4" }}"><h4 class="{{ fieldset.classes }}">{{ fieldset.legend }}</h4></td>
          </tr>
          {% endif %}
          {% for field in fieldset %}
          <tr{% if field.name in object.overrides %} class="warning"{% endif %}>
            <td>{{ field.name }}</td>
            <td>{{ field.help_text }}
              {% if field.field.choices %}
              <span class="options">
                {% for choice in field.field.choices %}
                <span class="option"><strong>({{ choice.0 }})</strong> {{ choice.1 }}</span>
                {% endfor %}
              </span>
              {% endif %}
            </td>
            <td class="submission-field">{{ submission_form|keyvalue:field.name }}</td>
            {% for sibling in submission_sibling_forms %}
            <td class="submission-field">{{ sibling|keyvalue:field.name }}</td>
            {% endfor %}
            <td class="submission-field">{{ field }}</td>
          </tr>
          {% endfor %}
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <table class="table table-striped table-bordered table-hover">
        <tbody>
          <tr>
            <td colspan="2">&nbsp;</td>
            <td>&nbsp;</td>
          </tr>
          {% for fieldset in form.fieldsets %}
          {% if fieldset.legend %}
          <tr>
            <td colspan="3"><h4 class="{{ fieldset.classes }}">{{ fieldset.legend }}</h4></td>
          </tr>
          {% endif %}
          {% for field in fieldset %}
          <tr{% if field.name in object.overrides %} class="warning"{% endif %}>
            <td>{{ field.name }}</td>
            <td>{{ field.help_text }}
              {% if field.field.choices %}
              <span class="options">
                {% for choice in field.field.choices %}
                <span class="option"><strong>({{ choice.0 }})</strong> {{ choice.1 }}</span>
                {% endfor %}
              </span>
              {% endif %}
            </td>
            <td style="text-align:center">{{ field }}</td>
          </tr>
          {% endfor %}
          {% endfor %}
        </tbody>
      </table>
      {% endif %}
    </div>
  </div>

  <div class="row">
    <div class="offset8 span2">
      <button type="submit" class="btn btn-info btn-large btn-block">Save</button>
    </div>
    <div class="span2">
      <a class="btn btn-large btn-block" href="{% url submissions_list object.form.pk %}">Cancel</a>
    </div>
  </div>
  </form>

  <div class="row">
    <p>&nbsp;</p>
  </div>
  {% endwith %}
{% endblock %}

{%- extends 'frontend/_layout.html' -%}
{%- from 'frontend/macros/participant_list_filter.html' import render_filter_form -%}
{%- from 'frontend/macros/pagination.html' import render_pager -%}
{% block toolbar %}
  <a class="btn btn-success pull-right" href="#"em style="margin-left:.5em;"> {% trans %}Send Message{% endtrans %}</a>
  <div class="pull-right">
    {% if perms.export_participants.can() %}
    <div class="form-group">
      <input type="submit" class="btn btn-default" name="export" value="{% trans %}Export{% endtrans %}">
    </div>
    {% endif %}
  </div>
  <a class="btn btn-info pull-right" href="{{ url_for('participants.participant_list_import') }}"em style="margin-right:.5em;"><i class="glyphicon glyphicon-upload glyphicon-white"></i> {% trans %}Import Participants{% endtrans %}</a>
{% endblock %}
{% block content %}
{%- set flash_msgs = get_flashed_messages(category_filter=['task_begun']) -%}
    <div class="row-fluid">
      <div class="well well-sm">
        {{ render_filter_form(filter_form) }}
      </div>
    </div>
{%- if flash_msgs -%}
    <div>
    {%- for msg in flash_msgs -%}
      <p class="alert alert-info">{{ msg }}</p>
    {%- endfor -%}
    </div>
{%- endif -%}
    <div class="row-fluid">
      <div>

        <form class="form-inline" action="{{ request.url }}" method="POST">
          {{ form.csrf_token() }}{{ form.select_superset() }}
          <!--<div class="checkbox" style="margin-left:10px;">
            <label>
              Select All
            </label><a href="#" class="btn btn-xs"><i class="glyphicon glyphicon-trash"></i></a>
          </div>-->
          <a href="#" id="delete" class="btn btn-sm btn-danger pull-left"><i class="glyphicon glyphicon-trash i_custom"></i></a>
          <table class="table table-bordered table-striped">
           <thead>
             <tr>
              <th><input type="checkbox" class="checked" id="select_all" name="select_all"></th>
               <th>{% trans %}ID{% endtrans %}</th>
               {%- for location_type in location_types -%}
               <th>{{ location_type.name }}</th>
               {%- endfor -%}
               <th>{% trans %}Location{% endtrans %}</th>
               <th>{% trans %}Name{% endtrans %}</th>
               <th>{% trans %}Role{% endtrans %}</th>
               <th>{% trans %}Phone{% endtrans %}</th>
               <th>{% trans %}Organization{% endtrans %}</th>
               {%- if perms.edit_participant.can() -%}
               <th class="text-center">{% trans %}Edit{% endtrans %}</th>
               {%- endif -%}
             </tr>
           </thead>
           <tbody>
             {% for participant in participants.items %}
             <tr>
               <td><input type="checkbox" class="checked" name="ids" value="{{ participant.id }}"></td>
               <td>{{ participant.participant_id }}</td>
               {%- for location_type in location_types -%}
               <td>{{ participant.location.ancestor(location_type.name).name }}</td>
               {%- endfor -%}
               <td>{{ participant.location }}</td>
               <td>{{ participant.name }}</td>
               <td>{{ participant.role }}</td>
               <td>{{ participant.phone }}</td>
               <td>{{ participant.partner }}</td>
               {%- if perms.edit_participant.can() -%}
               <td class="text-center"><a href="{{ url_for('participants.participant_edit', pk=participant.id) }}">Edit</a></td>
               {%- endif -%}
             </tr>
             {% else %}
             <!-- no data -->
             {% endfor %}
           </tbody>
          </table>
        </form>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
      {{ render_pager(participants, 'participants.participant_list', args) }}
      </div>
    </div>
{%- endblock -%}
</form>
{%- block scripts -%}
<script src="{{ url_for('static', filename='js/filters.js') }}"></script>
<script src="{{ url_for('static', filename='js/forms.js') }}"></script>
<script type="text/javascript">
  $(function(){
    $('#delete').hide();
    $('input[type="checkbox"]').click(function() {
      if (this.checked)
    {
      $('#delete').fadeIn('slow');
    }
    else
    {
        if ( !$('.checked:checked').length )
        {
            $('#delete').fadeOut('slow');
        }
    }

  });
});


</script>
{% if perms.send_messages.can() %}
{# TODO: send_message paginator.count #}
{% endif %}
{%- endblock -%}

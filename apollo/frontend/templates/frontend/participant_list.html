{%- extends 'frontend/_layout.html' -%}
{%- from 'frontend/macros/participant_list_filter.html' import render_filter_form -%}
{%- from 'frontend/macros/pagination.html' import render_pager -%}
{% block toolbar %}
  {% if perms.export_participants.can() %}
  <form action="{{ request.url }}" method="get" id="export_observers" style="display:none">
  {% for key, value in request.args.items() %}
  {% if key != "export" %}<input type="hidden" name="{{ key }}" value="{{ value }}" />{% endif %}
  {% endfor %}
  <input type="hidden" name="export" value="true" />
  </form>
  <a href="javascript:document.getElementById('export_observers').submit()" class="btn btn-default pull-right" type="submit">{% trans %}Export{% endtrans %}</a>
  {% endif %}

  <a class="btn btn-info pull-right" href="{{ url_for('participants.participant_list_import') }}"><i class="glyphicon glyphicon-upload glyphicon-white"></i> {% trans %}Import Participants{% endtrans %}</a>
{% endblock %}
{% block content %}
{%- set flash_msgs = get_flashed_messages(category_filter=['task_begun']) -%}
    <div class="row-fluid">
      <div class="well">
        {{ render_filter_form(filter_form) }}
      </div>
    </div>
{%- if flash_msgs -%}
    <div>
    {%- for msg in flash_msgs -%}
      <p class="alert alert-info">{{ msg }}</p>
    {%- endfor -%}
    </div>
{%- endif -%}
    <div class="row-fluid">
      <div>
      	<table class="table table-bordered table-striped">
         <thead>
           <tr>
             <th>{% trans %}ID{% endtrans %}</th>
             {%- for location_type in location_types -%}
             <th>{{ location_type.name }}</th>
             {%- endfor -%}
             <th>{% trans %}Location{% endtrans %}</th>
             <th>{% trans %}Name{% endtrans %}</th>
             <th>{% trans %}Role{% endtrans %}</th>
             <th>{% trans %}Organization{% endtrans %}</th>
             {%- if perms.edit_participant.can() -%}
             <th class="text-center">{% trans %}Edit{% endtrans %}</th>
             {%- endif -%}
           </tr>
         </thead>
         <tbody>
           {% for participant in participants.items %}
           <tr>
             <td>{{ participant.participant_id }}</td>
             {%- for location_type in location_types -%}
             <td>{{ participant.location.ancestor(location_type.name).name }}</td>
             {%- endfor -%}
             <td>{{ participant.location }}</td>
             <td>{{ participant.name }}</td>
             <td>{{ participant.role }}</td>
             <td>{{ participant.partner }}</td>
             {%- if perms.edit_participant.can() -%}
             <td class="text-center"><a href="{{ url_for('participants.participant_edit', pk=participant.id) }}">Edit</a></td>
             {%- endif -%}
           </tr>
           {% else %}
           <!-- no data -->
           {% endfor %}
         </tbody>
        </table>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
      {{ render_pager(participants, 'participants.participant_list', args) }}
      </div>
    </div>
{%- endblock -%}
{%- block javascripts -%}
<script src="{{ url_for('static', filename='js/filters.js') }}"></script>
{% if perms.send_messages.can() %}
{# TODO: send_message paginator.count #}
{% endif %}
{%- endblock -%}

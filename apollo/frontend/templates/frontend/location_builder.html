{% extends 'frontend/_layout.html' %}
{% block stylesheets %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/joint.min.css') }}">
{% endblock stylesheets %}
{% block toolbar %}
<div class="btn-group pull-right">
  <form action="{{ request.url }}" id="save-form" method="POST">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
    <input type="hidden" name="divisions_graph" id="divisions_graph" value="" />
    <button style="margin-left:1em" type="submit" class="btn btn-sm btn-primary" id="save"><i class="glyphicon glyphicon-floppy-save"></i> {{ _('Save') }}</button>
  </form>
</div>
<div class="btn-group pull-right">
  <button style="margin-left:1em" type="button" class="btn btn-sm btn-default" id="addDivisionButton"><i class="glyphicon glyphicon-plus"></i> {{ _('Add Division') }}</button>
  <a href="{{ url_for('locations.export_divisions', location_set_id=location_set.id) }}" class="btn btn-sm btn-default"><i class="glyphicon glyphicon-download"></i> {{ _('Export') }}</a>
</div>
{% endblock toolbar %}
{% block content %}
<div class="modal fade" id="addDivision" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">{{ _('Add Division') }}</h4>
      </div>
      <form role="form" class="form-horizontal">
      <div class="modal-body" style="padding-bottom:5px">
          <div class="form-group">
            <label for="name" class="col-sm-2 control-label">{{ _('Name') }}</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="addDivisionName">
            </div>
          </div>
          <div class="form-group">
            <label for="parents" class="col-sm-2 control-label">{{ _('Parents') }}</label>
            <div class="col-sm-10">
              <select multiple="multiple" class="form-control" name="parents" id="addDivisionParents">
              </select>
            </div>
          </div>
          <div class="form-group">
            <div class="col-sm-10 col-sm-offset-2">
              <div class="checkbox">
                <label for="addDivisionAdministrative">
                  <input type="checkbox" name="is_administrative" id="addDivisionAdministrative" value="true" /> {{ _('Administrative Division') }}
                </label>
              </div>
              <div class="checkbox">
                <label for="addDivisionPolitical">
                  <input type="checkbox" name="is_political" id="addDivisionPolitical" value="true" /> {{ _('Political Division') }}
                </label>
              </div>
              <div class="checkbox">
                <label for="addDivisionPoliticalCode">
                  <input type="checkbox" name="has_political_code" id="addDivisionPoliticalCode" value="true" /> {{ _('Has geopolitical code') }}
                </label>
              </div>
              <div class="checkbox">
                <label for="addDivisionOtherCode">
                  <input type="checkbox" name="has_other_code" id="addDivisionOtherCode" value="true" /> {{ _('Has other code') }}
                </label>
              </div>
              <div class="checkbox">
                <label for="addDivisionRegisteredVoters">
                  <input type="checkbox" name="has_registered_voters" id="addDivisionRegisteredVoters" value="true" /> {{ _('Has registered voters') }}
                </label>
              </div>
            </div>
          </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">{{ _('Close') }}</button>
        <button type="button" class="btn btn-primary" id="addModalSaveButton">{{ _('Add') }}</button>
      </div>
      </form>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<div class="modal fade" id="updateDivision" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">{{ _('Update Division') }}</h4>
      </div>
      <form role="form" class="form-horizontal">
      <div class="modal-body" style="padding-bottom:5px">
          <div class="form-group">
            <label for="name" class="col-sm-2 control-label">{{ _('Name') }}</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="updateDivisionName" name="name">
            </div>
          </div>
          <div class="form-group">
            <label for="parents" class="col-sm-2 control-label">{{ _('Parents') }}</label>
            <div class="col-sm-10">
              <select multiple="multiple" class="form-control" name="parents" id="updateDivisionParents">
              </select>
              <input type="hidden" class="form-control" id="updateDivisionId" name="id">
            </div>
          </div>
          <div class="form-group">
            <div class="col-sm-10 col-sm-offset-2">
              <div class="checkbox">
                <label for="updateDivisionAdministrative">
                  <input type="checkbox" name="is_administrative" id="updateDivisionAdministrative" value="true" /> {{ _('Administrative Division') }}
                </label>
              </div>
              <div class="checkbox">
                <label for="updateDivisionPolitical">
                  <input type="checkbox" name="is_political" id="updateDivisionPolitical" value="true" /> {{ _('Political Division') }}
                </label>
              </div>
              <div class="checkbox">
                <label for="updateDivisionPoliticalCode">
                  <input type="checkbox" name="has_political_code" id="updateDivisionPoliticalCode" value="true" /> {{ _('Has geopolitical code') }}
                </label>
              </div>
              <div class="checkbox">
                <label for="updateDivisionOtherCode">
                  <input type="checkbox" name="has_other_code" id="updateDivisionOtherCode" value="true" /> {{ _('Has other code') }}
                </label>
              </div>
              <div class="checkbox">
                <label for="updateDivisionRegisteredVoters">
                  <input type="checkbox" name="has_registered_voters" id="updateDivisionRegisteredVoters" value="true" /> {{ _('Has registered voters') }}
                </label>
              </div>
            </div>
          </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">{{ _('Close') }}</button>
        <button type="button" class="btn btn-danger" id="updateModalDeleteButton">{{ _('Delete') }}</button>
        <button type="button" class="btn btn-primary" id="updateModalSaveButton">{{ _('Update') }}</button>
      </div>
      </form>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
{%- set flash_msgs = get_flashed_messages(category_filter=['locations_builder']) -%}
{%- if flash_msgs -%}
<div class="row">
  <div class="col-md-12">
{%- for msg in flash_msgs -%}
    <div class="alert alert-info alert-dismissable">
      <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
      {{ msg }}
    </div>
{%- endfor -%}
  </div>
</div>
{%- endif -%}
<div class="row">
  <div class="col-md-10 col-md-offset-1">
    <div id="paper" style="margin-top: 5em; border: 1px solid #000;" data-graph='{{ location_set.make_admin_divisions_graph()|tojson }}'></div>
  </div>
</div>
{% endblock content %}
{% block scripts %}
<script type="text/javascript" src="{{ url_for('static', filename='js/lodash.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/backbone-min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/dagre.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/graphlib.core.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/joint.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/locations_builder.js') }}"></script>
{% endblock scripts %}
{% extends 'frontend/_layout.html' %}
{% block stylesheets %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/angular-form-builder.css') }}">
{% endblock %}
{% block content %}
<div ng-app="app">
<div class="row" id="formbuilder" ng-controller="BuilderController" data-form='{{ form_data|tojson }}'>
  <div class="col-md-6">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Builder</h3>
      </div>
      <div fb-builder="default"></div>
    </div>
  </div>
  <div class="col-md-6">
    <div fb-components></div>
  </div>
</div>
</div>
{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/angular.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/angular-form-builder.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/angular-formbuilder-components.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/angular-validator.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/angular-validator-rules.min.js') }}"></script>
<script type="text/javascript">
(function() {
  angular.module('app', ['builder', 'builder.components', 'validator.rules']).run([
    '$builder', function($builder) {
      return $builder;
    }
  ]).controller('BuilderController', [
    '$scope', '$builder', '$validator', function($scope, $builder, $validator) {
      var bootstrapData = JSON.parse(document.getElementById('formbuilder').dataset.form);

      for (var i = 0; i < bootstrapData.fields.length; i++)
        $builder.addFormObject('default', bootstrapData.fields[i]);
      $scope.form = $builder.forms['default'];
      $scope.input = [];
      $scope.defaultValue = {};
      return $scope.submit = function() {
        return $validator.validate($scope, 'default').success(function() {
          console.log(JSON.stringify($scope.form));
          return console.log('success');
        }).error(function() {
          return console.log('error');
        });
      };
    }
  ]);

}).call(this);

</script>
{% endblock %}